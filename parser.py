# Import modules
import nmap_parser
import sqlite3
import config

# Define parse results function
def parse_results(scan_output):
    # Create an Nmap parser object
    np = nmap_parser.NmapParser()

    # Parse the scan output file in XML format
    np.parse_fromfile(scan_output)

    # Connect to a SQLite database
    conn = sqlite3.connect(config.db_name)
    cur = conn.cursor()

    # Create a table for hosts and services
    cur.execute("""CREATE TABLE IF NOT EXISTS hosts_services (
        ip TEXT,
        port INTEGER,
        service TEXT,
        version TEXT,
        PRIMARY KEY (ip, port)
        )""")

    # Insert the parsed data into the table
    for host in np.hosts:
        for service in host.services:
            cur.execute("""INSERT OR IGNORE INTO hosts_services VALUES (?, ?, ?, ?)""",
                (host.address, service.port, service.service, service.version))

    # Commit changes and close connection
    conn.commit()
    conn.close()